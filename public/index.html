<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="referrer" content="no-referrer" />
  <meta name="description" content="Check whether your current connection uses IPv4 or IPv6, and view your public IP." />
  <title>IPv4 / IPv6 Check | JSW</title>
  <style>
    :root{--bg:#fff;--fg:#000;--muted:#333;--line:#000;--mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans","PingFang SC","Microsoft YaHei",sans-serif}
    .top{border-bottom:1px solid var(--line);padding:10px 12px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:center;font-size:14px}
    .pill{border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:#f6f6f6;font-size:12px}
    .wrap{max-width:900px;margin:0 auto;padding:18px 12px 30px}
    h1{margin:10px 0 6px;font-size:24px;font-weight:900}
    .sub{margin:0 0 14px;color:var(--muted);font-size:14px;line-height:1.6}
    .card{border:1px solid var(--line);border-radius:12px;padding:14px}
    .big{font-size:40px;font-weight:900;line-height:1.1;margin:0}
    .mono{font-family:var(--mono);word-break:break-all}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    button{background:#000;color:#fff;border:0;border-radius:8px;padding:10px 14px;font-size:14px;cursor:pointer}
    button:focus{outline:3px solid #000;outline-offset:2px}
    select{border:1px solid var(--line);border-radius:8px;padding:9px 10px;background:#fff;color:#000;font-size:14px}
    .ok{color:#0a7a2f;font-weight:900}
    .warn{color:#8a5a00;font-weight:900}
    details{margin-top:12px}
    pre{border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;font-size:12px;line-height:1.5}
  </style>
</head>
<body>
  <nav class="top" aria-label="Top">
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <strong class="mono">JSW</strong>
      <span class="pill">Host: <span id="host" class="mono"></span></span>
    </div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <label class="mono" for="langSel" style="font-size:12px;color:var(--muted)">LANG</label>
      <select id="langSel" aria-label="Language">
        <option value="en">English</option>
        <option value="zh-Hans">简体中文</option>
        <option value="zh-Hant">繁體中文</option>
      </select>
    </div>
  </nav>

  <main class="wrap" role="main">
    <h1 id="title">IPv4 / IPv6 Check</h1>
    <p class="sub" id="subtitle">Shows which IP version your current connection prefers.</p>

    <section class="card" aria-live="polite">
      <p class="big" id="headline">…</p>
      <p class="sub" id="hint" style="margin-top:8px">…</p>

      <div class="row">
        <span class="pill">IP: <span id="ip" class="mono">-</span></span>
        <span class="pill">Family: <span id="family" class="mono">-</span></span>
        <span class="pill"><span id="ts" class="mono">-</span></span>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="btn">Replay</button>
      </div>

      <details>
        <summary id="dbg">Debug</summary>
        <pre id="raw">（empty）</pre>
      </details>
    </section>
  </main>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  $("host").textContent = location.hostname;

  const T = {
    en: {
      title: "IPv4 / IPv6 Check",
      subtitle: "Shows which IP version your current connection prefers.",
      replay: "Replay",
      dbg: "Debug",
      head_v6: "You are on IPv6.",
      hint_v6: "Congrats — you can access IPv6-only websites.",
      head_v4: "You are on IPv4.",
      hint_v4: "IPv6 may be unavailable or your network prefers IPv4 right now.",
      head_u: "Unknown.",
      hint_u: "Could not determine IP family from this request."
    },
    "zh-Hans": {
      title: "IPv4 / IPv6 检测",
      subtitle: "显示你当前这次访问更偏向使用哪种 IP 协议栈。",
      replay: "重新测试",
      dbg: "调试信息",
      head_v6: "当前使用 IPv6",
      hint_v6: "恭喜：你可以访问纯 IPv6 网站。",
      head_v4: "当前使用 IPv4",
      hint_v4: "IPv6 可能不可用，或此刻网络更偏向 IPv4。",
      head_u: "未知",
      hint_u: "本次请求无法判断 IP 协议栈。"
    },
    "zh-Hant": {
      title: "IPv4 / IPv6 檢測",
      subtitle: "顯示你目前這次連線更偏向使用哪種 IP 協定棧。",
      replay: "重新測試",
      dbg: "除錯資訊",
      head_v6: "目前使用 IPv6",
      hint_v6: "恭喜：你可以存取純 IPv6 網站。",
      head_v4: "目前使用 IPv4",
      hint_v4: "IPv6 可能不可用，或此刻網路更偏向 IPv4。",
      head_u: "未知",
      hint_u: "本次請求無法判斷 IP 協定棧。"
    }
  };

  function detectLang() {
    const L = ((navigator.languages && navigator.languages[0]) || navigator.language || "en").toLowerCase();
    if (L.startsWith("zh")) return /tw|hk|mo|hant/.test(L) ? "zh-Hant" : "zh-Hans";
    return "en";
  }

  let lang = detectLang();
  const langSel = $("langSel");
  langSel.value = lang;

  function applyLang() {
    const t = T[lang] || T.en;
    document.documentElement.lang = lang === "zh-Hans" ? "zh-CN" : (lang === "zh-Hant" ? "zh-TW" : "en");
    $("title").textContent = t.title;
    $("subtitle").textContent = t.subtitle;
    $("btn").textContent = t.replay;
    $("dbg").textContent = t.dbg;
  }

  async function run() {
    applyLang();
    $("headline").textContent = "…";
    $("hint").textContent = "…";
    $("ip").textContent = "-";
    $("family").textContent = "-";
    $("ts").textContent = "-";
    $("raw").textContent = "（empty）";

    try {
      const r = await fetch(`/api/ip?ts=${Date.now()}`, { cache: "no-store" });
      const txt = await r.text();
      if (!r.ok) throw new Error("HTTP " + r.status);
      const data = JSON.parse(txt);

      $("ip").textContent = data.ip || "-";
      $("family").textContent = data.family || "unknown";
      $("ts").textContent = data.time || new Date().toISOString();
      $("raw").textContent = JSON.stringify(data, null, 2);

      const t = T[lang] || T.en;
      if (data.family === "ipv6") {
        $("headline").innerHTML = `<span class="ok">${t.head_v6}</span>`;
        $("hint").textContent = t.hint_v6;
      } else if (data.family === "ipv4") {
        $("headline").innerHTML = `<span class="warn">${t.head_v4}</span>`;
        $("hint").textContent = t.hint_v4;
      } else {
        $("headline").textContent = t.head_u;
        $("hint").textContent = t.hint_u;
      }
    } catch (e) {
      const t = T[lang] || T.en;
      $("headline").textContent = t.head_u;
      $("hint").textContent = String(e && e.message ? e.message : e);
    }
  }

  $("btn").addEventListener("click", run);
  langSel.addEventListener("change", () => { lang = langSel.value; run(); });

  run();
})();
</script>
</body>
</html>
